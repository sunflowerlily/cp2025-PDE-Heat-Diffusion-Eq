# 项目2：地壳中的热扩散 - 时变边界条件热传导问题

## 项目背景

地壳中的热传导是一个经典的边界条件随时间变化的热传导问题，因为地表温度随季节变化。这个问题在地球物理学、建筑工程和环境科学中都有重要应用。

### 物理模型

考虑一维垂直方向的热传导方程：

$$\frac{\partial T(z,t)}{\partial t} = D \frac{\partial^2 T(z,t)}{\partial z^2}$$

其中：
- $T(z,t)$ 是深度 $z$ 处在时间 $t$ 的温度
- $D = 0.1 \, \text{m}^2/\text{day}$ 是热扩散率
- $z$ 是深度（向下为正，单位：米）
- $t$ 是时间（单位：天）

### 边界条件和初始条件

**边界条件：**
- 地表温度（$z = 0$）：$T_0(t) = A + B\sin\left(\frac{2\pi t}{\tau}\right)$
  - $A = 10°C$（年平均温度）
  - $B = 12°C$（温度振幅）
  - $\tau = 365$ 天（周期）
- 深度20米处（$z = 20\text{m}$）：$T(20,t) = 11°C$（常温）

**初始条件：**
- 除地表和20米深处外，其他位置初始温度均为 $10°C$

### 物理参数

| 参数 | 数值 | 单位 | 说明 |
|------|------|------|------|
| $D$ | 0.1 | m²/day | 热扩散率 |
| $A$ | 10 | °C | 年平均地表温度 |
| $B$ | 12 | °C | 地表温度年变化振幅 |
| $\tau$ | 365 | day | 年周期 |
| 深度范围 | 0-20 | m | 计算区域 |
| 时间范围 | 0-10 | year | 模拟时间 |

## 学习目标

通过完成本项目，学生将：

1. **理论掌握**
   - 理解时变边界条件对热传导的影响
   - 掌握周期性边界条件的处理方法
   - 理解地球物理中的热扩散现象

2. **数值技能**
   - 实现处理时变边界条件的差分格式
   - 掌握长时间尺度数值模拟的技巧
   - 学会分析周期性解的特征

3. **可视化能力**
   - 绘制温度轮廓图展示季节变化
   - 制作动画显示热扩散过程
   - 分析温度随深度和时间的变化规律

## 详细任务

### 任务1：数值求解器实现 (30分)

实现求解时变边界条件热传导方程的数值方法：

**要求：**
- 使用隐式差分格式确保数值稳定性
- 正确处理时变上边界条件
- 正确处理固定下边界条件
- 实现高效的矩阵求解算法

**函数接口：**
```python
def solve_earth_crust_diffusion(nz, nt, total_time_years):
    """
    求解地壳热扩散方程
    
    参数:
        nz (int): 深度方向网格点数
        nt (int): 时间步数
        total_time_years (float): 总模拟时间（年）
    
    返回:
        tuple: (depth_array, time_array, temperature_matrix)
    """
```

### 任务2：长期演化分析 (25分)

分析地壳温度的长期演化特征：

**要求：**
- 运行9年模拟，分析系统达到周期性稳态的过程
- 计算不同深度处温度振幅的衰减
- 分析温度波的相位延迟随深度的变化
- 验证数值解的能量守恒性

**函数接口：**
```python
def analyze_long_term_evolution(depth, time, temperature):
    """
    分析长期温度演化特征
    
    参数:
        depth (array): 深度数组
        time (array): 时间数组
        temperature (array): 温度矩阵
    
    返回:
        dict: 包含振幅衰减、相位延迟等分析结果
    """
```

### 任务3：季节性温度轮廓可视化 (25分)

绘制第10年的季节性温度变化：

**要求：**
- 在第10年选择4个时间点（代表四季）
- 绘制温度随深度变化的轮廓图
- 所有轮廓显示在同一图中，便于比较
- 图表标注使用英文

**函数接口：**
```python
def plot_seasonal_profiles(depth, temperature_profiles, seasons):
    """
    绘制季节性温度轮廓
    
    参数:
        depth (array): 深度数组
        temperature_profiles (array): 四个季节的温度轮廓
        seasons (list): 季节标签
    
    返回:
        matplotlib.figure.Figure: 温度轮廓图
    """
```

### 任务4：理论解析解比较 (15分)

计算并比较理论解析解：

**要求：**
- 推导半无限介质中的解析解
- 计算温度振幅随深度的指数衰减
- 计算相位延迟随深度的线性变化
- 与数值解进行定量比较

**函数接口：**
```python
def analytical_solution(depth, time, surface_temp_params):
    """
    计算解析解
    
    参数:
        depth (array): 深度数组
        time (array): 时间数组
        surface_temp_params (dict): 地表温度参数
    
    返回:
        array: 解析解温度矩阵
    """
```

### 任务5：参数敏感性分析 (5分)

分析关键参数对结果的影响：

**要求：**
- 分析热扩散率变化的影响
- 分析地表温度振幅变化的影响
- 绘制参数敏感性图表

## 提示与资源

### 关键公式

**1. 解析解（半无限介质）：**

对于半无限介质，解析解为：
$$T(z,t) = A + B e^{-z/\delta} \sin\left(\frac{2\pi t}{\tau} - \frac{z}{\delta}\right)$$

其中特征深度：$\delta = \sqrt{\frac{D\tau}{\pi}}$

**2. 数值格式（隐式）：**

$$\frac{T_i^{n+1} - T_i^n}{\Delta t} = D \frac{T_{i+1}^{n+1} - 2T_i^{n+1} + T_{i-1}^{n+1}}{(\Delta z)^2}$$

**3. 稳定性条件：**

隐式格式无条件稳定，但为保证精度建议：$\Delta t \leq \frac{(\Delta z)^2}{2D}$

### 编程提示

**1. 网格设置：**
```python
# 推荐网格参数
nz = 101  # 深度网格点数
nt = 3650  # 时间步数（10年，每天一步）
dz = 20.0 / (nz - 1)  # 空间步长
dt = 10 * 365 / nt  # 时间步长
```

**2. 边界条件处理：**
```python
# 地表温度（时变边界条件）
T_surface = A + B * np.sin(2 * np.pi * time / tau)

# 深度20米处（固定边界条件）
T_bottom = 11.0
```

**3. 矩阵求解：**
```python
# 使用scipy求解三对角矩阵系统
from scipy.linalg import solve_banded
```

### 物理解释

**1. 特征深度：**
- $\delta \approx 3.4$ 米，表示温度振幅衰减到地表的1/e的深度
- 在深度约10米处，温度变化已经很小

**2. 相位延迟：**
- 地下温度变化滞后于地表温度
- 每米深度约延迟15天

**3. 能量守恒：**
- 系统总热能应保持守恒（除边界热流外）
- 可用于验证数值解的正确性

## 评分标准

### 代码实现 (70分)

| 评分项目 | 分值 | 评分标准 |
|----------|------|----------|
| 数值求解器 | 30分 | 正确实现隐式差分格式，处理时变边界条件 |
| 长期演化分析 | 25分 | 正确分析周期性稳态，计算振幅和相位 |
| 可视化实现 | 25分 | 高质量的季节性温度轮廓图 |
| 解析解比较 | 15分 | 正确计算解析解并与数值解比较 |
| 参数敏感性 | 5分 | 分析关键参数的影响 |

### 实验报告 (25分)

| 评分项目 | 分值 | 评分标准 |
|----------|------|----------|
| 物理背景阐述 | 8分 | 清晰解释地壳热扩散的物理机制 |
| 数值方法说明 | 7分 | 详细说明数值格式和边界条件处理 |
| 结果分析讨论 | 7分 | 深入分析温度分布规律和物理意义 |
| 图表质量 | 3分 | 图表清晰美观，标注规范 |

### 代码质量 (5分)

- 代码结构清晰，注释完整
- 函数设计合理，接口规范
- 错误处理和数值稳定性考虑

## 扩展思考

1. **实际应用：**
   - 地源热泵系统设计
   - 建筑地基温度预测
   - 考古学中的年代测定

2. **模型改进：**
   - 考虑土壤含水量对热扩散率的影响
   - 加入地下水流动的对流传热
   - 考虑非均匀土壤的分层模型

3. **数值方法优化：**
   - 自适应时间步长
   - 高阶精度格式
   - 并行计算实现

---

**注意：所有图表标注（标题、坐标轴标签、图例）必须使用英文！**